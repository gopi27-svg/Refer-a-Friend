<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Refer a Friend</title>
  <!-- tiny blank favicon to silence 404 -->
  <link rel="icon" href="data:;base64,iVBORw0KGgo=">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
  <style>
    *{box-sizing:border-box;margin:0;padding:0;font-family:'Poppins',sans-serif}
    body{background:linear-gradient(to right top,#3b0064,#6f00a3);min-height:100vh;display:flex;justify-content:center;align-items:center;padding:2rem;color:#fff}
    .container{background:rgba(255,255,255,.05);box-shadow:0 8px 32px rgba(0,0,0,.4);border-radius:20px;backdrop-filter:blur(15px);padding:3rem 2rem;width:100%;max-width:600px;animation:fadeIn 1s ease forwards}
    @keyframes fadeIn{from{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}
    h1{text-align:center;margin-bottom:2rem;font-weight:600;font-size:2rem;color:#ffeaff}
    .field{margin-bottom:1.5rem;position:relative}
    .field input,.field select{width:100%;padding:1rem;border-radius:10px;border:1px solid #ffffff30;background:rgba(255,255,255,.1);color:#fff;font-size:1rem;outline:none;transition:.3s}
    .field input::placeholder,.field select option{color:#ccc}
    .field label{position:absolute;top:-12px;left:12px;background:#6f00a3;padding:0 8px;font-size:.9rem;color:#ffeaff;border-radius:6px}
    button{width:100%;padding:1rem;border:none;border-radius:10px;background:linear-gradient(to right,#a05dff,#c471ed);color:#fff;font-size:1.2rem;font-weight:600;cursor:pointer;transition:background .3s}
    button:hover{background:linear-gradient(to right,#843ae0,#b24cfb)}
    #response{text-align:center;margin-top:1rem;font-size:1rem}
  </style>
</head>
<body>
  <div class="container">
    <h1>REFER A FRIEND</h1>

    <form id="referralForm" autocomplete="off" novalidate>
      <div class="field">
        <label for="employeeName">EMPLOYEE NAME (Referred by)</label>
        <input type="text" id="employeeName" name="employeeName" required />
      </div>

      <div class="field">
        <label for="referredFor">REFERRED FOR</label>
        <select id="referredFor" name="referredFor" required>
          <option value="" disabled selected hidden style="color:#ccc;">Select Role</option>
        </select>
      </div>

      <div class="field">
        <label for="employeeCode">EMPLOYEE CODE</label>
        <input type="text" id="employeeCode" name="employeeCode" required />
      </div>

      <div class="field">
        <label for="employeeEmail">EMPLOYEE EMAIL ID</label>
        <input type="email" id="employeeEmail" name="employeeEmail" required />
      </div>

      <div class="field">
        <label for="candidateName">CANDIDATE NAME</label>
        <input type="text" id="candidateName" name="candidateName" required />
      </div>

      <div class="field">
        <label for="candidatePhone">CANDIDATE PHONE NO</label>
        <input type="text" id="candidatePhone" name="candidatePhone" required />
      </div>

      <div class="field">
        <label for="candidateLocation">CANDIDATE CURRENT LOCATION</label>
        <input type="text" id="candidateLocation" name="candidateLocation" required />
      </div>

      <div class="field">
        <label for="proposedLocation">PROPOSED LOCATION</label>
        <select id="proposedLocation" name="proposedLocation" required>
          <option value="" disabled selected hidden>Select Location</option>
          <option>Bangalore</option><option>Mumbai</option><option>Pune</option><option>NCR</option>
          <option>Ranchi</option><option>Mysore</option><option>Coimbatore</option><option>Lucknow</option>
          <option>Kochi</option><option>Hyderabad</option><option>Chennai</option><option>Mangalore</option>
          <option>Coimbatore</option>
        </select>
      </div>

      <div class="field">
        <label for="cvFile">CANDIDATE CV (PDF/DOC)</label>
        <input type="file" id="cvFile" name="cvFile" accept=".pdf,.doc,.docx" required />
      </div>

      <button type="submit" id="submitBtn">Submit</button>
      <div id="response"></div>
    </form>
  </div>

  <script>
    // Your deployed Apps Script Web App URL:
    const WEB_APP_URL = "https://script.google.com/macros/s/AKfycbxgdsv8Si300F39-Ip9q2BRuWMdAU9yB8G64asWPTkVwVmkgbuClH8sVU6LDwUlTTJk/exec";

    // Populate roles
    (function(){
      const roles = [
        "Faculty / Teaching Role",
        "Sales (Inside Sales, Referrals, Channel Sales)",
        "Operation (LEnS, Retention, Biz Ops, Student Onboarding)",
        "Finance and Accounts",
        "Marketing",
        "Business Intelligence (Data Management, Analytics, Reporting)",
        "Centralized Procurement",
        "Content Development and Management (Content & Media)",
        "Human Resources",
        "Learning (DSM / Program Managers)",
        "Certifications",
        "Technology",
        "University Relations"
      ];
      const sel = document.getElementById('referredFor');
      roles.forEach(r => { const o = document.createElement('option'); o.value=r; o.textContent=r; sel.appendChild(o); });
    })();

    const form = document.getElementById('referralForm');
    const responseDiv = document.getElementById('response');
    const submitBtn = document.getElementById('submitBtn');

    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      responseDiv.textContent = '';
      submitBtn.disabled = true;
      submitBtn.textContent = 'Submitting...';

      try {
        // Validate file
        const file = document.getElementById('cvFile').files[0];
        if (!file) throw new Error('CV file is required');
        const ext = (file.name.split('.').pop()||'').toLowerCase();
        if (!['pdf','doc','docx'].includes(ext)) throw new Error('Only PDF/DOC/DOCX allowed');

        // Convert file â†’ Data URL (Base64)
        const dataUrl = await toDataURL(file);

        // Build payload
        const payload = {
          employeeName: form.employeeName.value.trim(),
          referredFor: form.referredFor.value,
          employeeCode: form.employeeCode.value.trim(),
          employeeEmail: form.employeeEmail.value.trim(),
          candidateName: form.candidateName.value.trim(),
          candidatePhone: form.candidatePhone.value.trim(),
          candidateLocation: form.candidateLocation.value.trim(),
          proposedLocation: form.proposedLocation.value,
          file: { name: file.name, type: file.type || mimeFromExt(ext), data: dataUrl }
        };

        // POST as text/plain to avoid CORS preflight
        const res = await fetch(WEB_APP_URL, {
          method: 'POST',
          headers: { 'Content-Type': 'text/plain;charset=utf-8' },
          body: JSON.stringify(payload)
        });

        // Parse response safely
        const text = await res.text();
        let json; try { json = JSON.parse(text); } catch { json = { ok: res.ok, message: text }; }

        if (!json.ok) throw new Error(json.error || json.message || 'Submission failed');

        // Success screen
        form.innerHTML = `
          <h2 style="text-align:center; color:#bbffbb; margin-top: 2rem;">
            ðŸŽ‰ Referral submitted successfully!
          </h2>
          <p style="text-align:center; color:#bbffbb;">Thank you.</p>
        `;
      } catch (err) {
        responseDiv.style.color = '#ff6b6b';
        responseDiv.textContent = 'âŒ ' + (err.message || String(err));
        submitBtn.disabled = false;
        submitBtn.textContent = 'Submit';
      }
    });

    function toDataURL(file){
      return new Promise((resolve, reject)=>{
        const r = new FileReader();
        r.onload = e => resolve(e.target.result);
        r.onerror = reject;
        r.readAsDataURL(file);
      });
    }
    function mimeFromExt(ext){
      if (ext==='pdf') return 'application/pdf';
      if (ext==='doc') return 'application/msword';
      if (ext==='docx') return 'application/vnd.openxmlformats-officedocument.wordprocessingml.document';
      return 'application/octet-stream';
    }
  </script>
</body>
</html>
